<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>×˜×™×™××¨ ××©×™××•×ª</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f8f8f8; margin:20px; }
        h1 { text-align:center; }
        p { text-align:center; }
        table { width:100%; border-collapse:collapse; margin-top:20px; background:white; }
        th, td { border:1px solid #ccc; padding:8px; text-align:center; }
        th { background:#eee; }
        button { margin:2px; padding:5px 10px; }
        form.inline { display:inline; }
        .finished { background:#d3ffd3; }
        .running { background:#fff7cc; }
        .paused { background:#fdd; }
    </style>
</head>
<body>

<h1>â±ï¸ ×˜×™×™××¨ ××©×™××•×ª</h1>

{% if total_end_time %}
<p><strong>ğŸ•’ ×›×œ ×”××©×™××•×ª ×¦×¤×•×™×•×ª ×œ×”×¡×ª×™×™× ×‘×©×¢×”:</strong> {{ total_end_time }}</p>
{% endif %}

<!-- ×˜×•×¤×¡ ×”×•×¡×¤×ª ××©×™××” -->
<form action="{{ url_for('add_task') }}" method="post">
    <input type="text" name="name" placeholder="×©× ××©×™××”" required>
    <label>×©×¢×•×ª:</label>
    <input type="number" name="hours" min="0" value="0">
    <label>×“×§×•×ª:</label>
    <input type="number" name="minutes" min="0" value="0">
    <label>×©× ×™×•×ª:</label>
    <input type="number" name="seconds" min="0" value="0">
    <button type="submit">â• ×”×•×¡×£ ××©×™××”</button>
</form>

<!-- ×˜×‘×œ×ª ××©×™××•×ª -->
<table>
    <tr>
        <th>×©× ××©×™××”</th>
        <th>×¡×˜×˜×•×¡</th>
        <th>× ×•×ª×¨</th>
        <th>×©×¢×ª ×¡×™×•×</th>
        <th>×¤×¢×•×œ×•×ª</th>
    </tr>
    {% for task in tasks %}
    <tr class="{% if task.status=='×¨×¥' %}running{% elif task.status=='×”×¡×ª×™×™×' %}finished{% elif task.status=='×¢×¦×•×¨×”' %}paused{% endif %}">
        <td>
            <!-- ×¢×¨×™×›×ª ××©×™××” -->
            <form action="{{ url_for('edit_task', task_id=task.id) }}" method="post">
                <input type="text" name="name" value="{{ task.name }}">
                <input type="number" name="hours" min="0" value="{{ task.duration // 3600 }}">
                <input type="number" name="minutes" min="0" value="{{ (task.duration % 3600) // 60 }}">
                <input type="number" name="seconds" min="0" value="{{ task.duration % 60 }}">
                <button type="submit">ğŸ’¾</button>
            </form>
        </td>
        <td>{{ task.status }}</td>
        <td>
            <span class="countdown"
                  data-remaining="{{ task.remaining() }}">
                  {{ task.formatted_remaining() }}
            </span>
        </td>
        <td>
            {% if task.status == "×¨×¥" and task.end_time %}
                {{ task.end_time.strftime("%H:%M:%S") }}
            {% elif task.status == "×”×¡×ª×™×™×" %}
                âœ… ×”×¡×ª×™×™×
            {% else %}
                â³ ×××ª×™×Ÿ
            {% endif %}
        </td>
        <td>
            <form action="{{ url_for('start_task', task_id=task.id) }}" method="get" class="inline">
                <button type="submit">â–¶ï¸ ×”×ª×—×œ</button>
            </form>
            <form action="{{ url_for('pause_task', task_id=task.id) }}" method="get" class="inline">
                <button type="submit">â¸ï¸ ×”×©×”×”</button>
            </form>
            <form action="{{ url_for('reset_task', task_id=task.id) }}" method="get" class="inline">
                <button type="submit">ğŸ”„ ××¤×¡</button>
            </form>
            <form action="{{ url_for('finish_task', task_id=task.id) }}" method="get" class="inline">
                <button type="submit">âœ… ×¡×™×™×</button>
            </form>
            <form action="{{ url_for('delete_task', task_id=task.id) }}" method="get" class="inline">
                <button type="submit">ğŸ—‘ï¸ ××—×§</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<!-- JS ×œ×¡×¤×™×¨×” ×œ××—×•×¨ -->
<script>
function updateCountdowns() {
    document.querySelectorAll(".countdown").forEach(el => {
        let remaining = parseInt(el.dataset.remaining);
        if (isNaN(remaining)) return;

        if (remaining > 0) {
            remaining -= 1;
            el.dataset.remaining = remaining;

            let h = Math.floor(remaining / 3600);
            let m = Math.floor((remaining % 3600) / 60);
            let s = remaining % 60;
            el.textContent = 
                h.toString().padStart(2,"0")+":"+
                m.toString().padStart(2,"0")+":"+
                s.toString().padStart(2,"0");
        }
    });
}
setInterval(updateCountdowns, 1000);
</script>

</body>
</html>
