<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>⏱ טיימר משימות</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>⏱ טיימר משימות</h1>

    <form action="/add" method="POST">
        <input type="text" name="name" placeholder="שם משימה" required>
        <input type="number" name="hours" placeholder="שעות" min="0" max="23" value="0">
        <input type="number" name="minutes" placeholder="דקות" min="0" max="59" value="0">
        <input type="number" name="seconds" placeholder="שניות" min="0" max="59" value="0">
        <button type="submit">➕ הוסף משימה</button>
    </form>

    <h2>רשימת משימות</h2>
    <ul>
        {% for task in tasks %}
        <li>
            {% if edit_id == task.id %}
                <form action="/update/{{ task.id }}" method="POST">
                    <input type="text" name="name" value="{{ task.name }}" required>
                    <input type="number" name="hours" value="{{ task.duration // 3600 }}" min="0" max="23">
                    <input type="number" name="minutes" value="{{ (task.duration % 3600) // 60 }}" min="0" max="59">
                    <input type="number" name="seconds" value="{{ task.duration % 60 }}" min="0" max="59">
                    <button type="submit">💾 שמור</button>
                    <a href="{{ url_for('index') }}">❌ ביטול</a>
                </form>
            {% else %}
                <b>{{ task.name }}</b><br>
                <span id="timer-{{ task.id }}">
                    {% set rt = task.remaining_time() %}
                    {{ "%02d:%02d:%02d" % (rt//3600, (rt%3600)//60, rt%60) }}
                </span>
                {% if task.end_time %}
                    <div>⏳ סיום משוער: {{ task.end_time.strftime("%H:%M:%S") }}</div>
                {% endif %}

                <div class="task-actions">
                    {% if task.status == "pending" %}
                        <a href="/start/{{ task.id }}">▶ התחל</a>
                        <a href="{{ url_for('index', edit=task.id) }}">✏ ערוך</a>
                    {% elif task.status == "running" %}
                        <a href="/pause/{{ task.id }}">⏸ עצור</a>
                    {% elif task.status == "paused" %}
                        <a href="/resume/{{ task.id }}">⏯ המשך</a>
                        <a href="{{ url_for('index', edit=task.id) }}">✏ ערוך</a>
                    {% endif %}
                    <a href="/finish/{{ task.id }}">✔ סיים</a>
                    <a href="/delete/{{ task.id }}" onclick="return confirm('למחוק משימה?')">🗑 מחק</a>
                </div>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
</body>
</html>
