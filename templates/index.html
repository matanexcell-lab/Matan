<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>⏱️ טיימר משימות</title>
  <script>
    async function addTask() {
      const name = document.getElementById("name").value;
      const hours = document.getElementById("hours").value;
      const minutes = document.getElementById("minutes").value;
      const seconds = document.getElementById("seconds").value;

      await fetch("/add", {
        method: "POST",
        body: new URLSearchParams({name, hours, minutes, seconds})
      });
      location.reload();
    }

    async function startTask(id) {
      await fetch(`/start/${id}`, {method: "POST"});
    }

    async function pauseTask(id) {
      await fetch(`/pause/${id}`, {method: "POST"});
    }

    async function deleteTask(id) {
      await fetch(`/delete/${id}`, {method: "DELETE"});
      location.reload();
    }

    async function updateTimers() {
      const timers = document.querySelectorAll(".task");
      for (let t of timers) {
        const id = t.dataset.id;
        const res = await fetch(`/remaining/${id}`);
        const data = await res.json();
        if (data.remaining_seconds !== undefined) {
          const sec = data.remaining_seconds;
          const h = Math.floor(sec / 3600);
          const m = Math.floor((sec % 3600) / 60);
          const s = sec % 60;
          t.querySelector(".remaining").innerText = `${h}:${m}:${s}`;
        }
      }
    }
    setInterval(updateTimers, 1000);
  </script>
</head>
<body>
  <h1>⏱️ טיימר משימות</h1>

  <div>
    <input id="name" placeholder="שם משימה">
    <input id="hours" type="number" placeholder="שעות" value="0">
    <input id="minutes" type="number" placeholder="דקות" value="0">
    <input id="seconds" type="number" placeholder="שניות" value="0">
    <button onclick="addTask()">➕ הוסף משימה</button>
  </div>

  <h2>רשימת משימות</h2>
  <ul>
    {% for task in tasks %}
      <li class="task" data-id="{{task.id}}">
        <b>{{task.name}}</b> | נותר: 
        <span class="remaining">--:--:--</span>
        <button onclick="startTask({{task.id}})">▶️ התחל</button>
        <button onclick="pauseTask({{task.id}})">⏸️ השהה</button>
        <button onclick="deleteTask({{task.id}})">🗑️ מחק</button>
      </li>
    {% endfor %}
  </ul>
</body>
</html>
