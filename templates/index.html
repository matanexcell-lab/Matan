<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ניהול משימות</title>
    <style>
        body { font-family: Arial, sans-serif; direction: rtl; text-align: center; }
        table { margin: auto; border-collapse: collapse; width: 80%; }
        th, td { border: 1px solid black; padding: 8px; }
        button { margin: 2px; }
    </style>
</head>
<body>
    <h1>ניהול משימות</h1>

    <h3>הוספת משימה</h3>
    <input id="name" placeholder="שם משימה">
    <input id="hours" type="number" placeholder="שעות" min="0">
    <input id="minutes" type="number" placeholder="דקות" min="0">
    <input id="seconds" type="number" placeholder="שניות" min="0">
    <button onclick="addTask()">הוסף</button>

    <h3>רשימת משימות</h3>
    <table>
        <thead>
            <tr>
                <th>שם</th>
                <th>זמן נשאר</th>
                <th>סטטוס</th>
                <th>פעולות</th>
            </tr>
        </thead>
        <tbody id="taskTable"></tbody>
    </table>

<script>
async function addTask() {
    const name = document.getElementById("name").value;
    const hours = document.getElementById("hours").value || 0;
    const minutes = document.getElementById("minutes").value || 0;
    const seconds = document.getElementById("seconds").value || 0;

    await fetch("/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, hours, minutes, seconds })
    });
    loadTasks();
}

async function startTask(id) {
    await fetch("/start/" + id, { method: "POST" });
    loadTasks();
}

async function pauseTask(id) {
    await fetch("/pause/" + id, { method: "POST" });
    loadTasks();
}

async function resetTask(id) {
    await fetch("/reset/" + id, { method: "POST" });
    loadTasks();
}

async function deleteTask(id) {
    await fetch("/delete/" + id, { method: "POST" });
    loadTasks();
}

async function loadTasks() {
    const res = await fetch("/state");
    const tasks = await res.json();
    const tbody = document.getElementById("taskTable");
    tbody.innerHTML = "";
    tasks.forEach(t => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${t.name}</td>
            <td>${formatTime(t.remaining)}</td>
            <td>${t.status}</td>
            <td>
                <button onclick="startTask(${t.id})">התחל</button>
                <button onclick="pauseTask(${t.id})">השהה</button>
                <button onclick="resetTask(${t.id})">אפס</button>
                <button onclick="deleteTask(${t.id})">מחק</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

function formatTime(seconds) {
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = Math.floor(seconds % 60);
    return `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}

setInterval(loadTasks, 1000);
loadTasks();
</script>
</body>
</html>
